<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>数据可视化测试 - 安全管理交互平台</title>
  <link rel="stylesheet" href="./styles/main.css">
  <style>
    body {
      padding: 20px;
      background: #f8fafc;
    }
    
    .test-container {
      max-width: 1200px;
      margin: 0 auto;
    }
    
    .test-section {
      background: white;
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 24px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }
    
    .test-section h2 {
      margin: 0 0 20px 0;
      color: #1f2937;
      border-bottom: 2px solid #e5e7eb;
      padding-bottom: 12px;
    }
    
    .chart-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }
    
    .chart-container {
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      padding: 16px;
      background: #fafafa;
    }
    
    .chart-container h3 {
      margin: 0 0 16px 0;
      font-size: 16px;
      color: #374151;
    }
    
    .test-controls {
      display: flex;
      gap: 12px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    
    .btn {
      padding: 8px 16px;
      border: 1px solid #d1d5db;
      border-radius: 6px;
      background: white;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.2s ease;
    }
    
    .btn:hover {
      background: #f3f4f6;
      border-color: #9ca3af;
    }
    
    .btn.primary {
      background: #3b82f6;
      color: white;
      border-color: #3b82f6;
    }
    
    .btn.primary:hover {
      background: #2563eb;
    }
    
    .status {
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 600;
      margin-left: 8px;
    }
    
    .status.success {
      background: #dcfce7;
      color: #166534;
    }
    
    .status.error {
      background: #fee2e2;
      color: #991b1b;
    }
  </style>
</head>
<body>
  <div class="test-container">
    <header>
      <h1>📊 数据可视化功能测试</h1>
      <p>测试新开发的图表组件和数据可视化功能</p>
    </header>

    <!-- 基础图表测试 -->
    <section class="test-section">
      <h2>基础图表组件测试</h2>
      <div class="test-controls">
        <button class="btn primary" onclick="testBasicCharts()">测试基础图表</button>
        <button class="btn" onclick="testChartAnimations()">测试动画效果</button>
        <button class="btn" onclick="testChartInteractions()">测试交互功能</button>
        <span id="basic-status" class="status"></span>
      </div>
      
      <div class="chart-grid">
        <div class="chart-container">
          <h3>柱状图测试</h3>
          <div id="bar-chart" style="height: 300px;"></div>
        </div>
        
        <div class="chart-container">
          <h3>折线图测试</h3>
          <div id="line-chart" style="height: 300px;"></div>
        </div>
        
        <div class="chart-container">
          <h3>饼图测试</h3>
          <div id="pie-chart" style="height: 300px;"></div>
        </div>
        
        <div class="chart-container">
          <h3>环形图测试</h3>
          <div id="doughnut-chart" style="height: 300px;"></div>
        </div>
      </div>
    </section>

    <!-- 学习进度图表测试 -->
    <section class="test-section">
      <h2>学习进度图表测试</h2>
      <div class="test-controls">
        <button class="btn primary" onclick="testProgressCharts()">测试进度图表</button>
        <button class="btn" onclick="testProgressAnimations()">测试进度动画</button>
        <span id="progress-status" class="status"></span>
      </div>
      
      <div class="chart-grid">
        <div class="chart-container">
          <h3>学习进度趋势</h3>
          <div id="progress-trend" style="height: 300px;"></div>
        </div>
        
        <div class="chart-container">
          <h3>完成率环形图</h3>
          <div id="completion-rate" style="height: 300px;"></div>
        </div>
        
        <div class="chart-container">
          <h3>学习路径进度</h3>
          <div id="learning-path" style="height: 300px;"></div>
        </div>
      </div>
    </section>

    <!-- 答题统计图表测试 -->
    <section class="test-section">
      <h2>答题统计图表测试</h2>
      <div class="test-controls">
        <button class="btn primary" onclick="testQuizCharts()">测试答题图表</button>
        <button class="btn" onclick="testKnowledgeRadar()">测试知识点雷达图</button>
        <span id="quiz-status" class="status"></span>
      </div>
      
      <div class="chart-grid">
        <div class="chart-container">
          <h3>正确率分布</h3>
          <div id="accuracy-distribution" style="height: 300px;"></div>
        </div>
        
        <div class="chart-container">
          <h3>答题时间分析</h3>
          <div id="time-analysis" style="height: 300px;"></div>
        </div>
        
        <div class="chart-container">
          <h3>知识点掌握雷达图</h3>
          <div id="knowledge-radar" style="height: 300px;"></div>
        </div>
      </div>
    </section>

    <!-- 实时仪表板测试 -->
    <section class="test-section">
      <h2>实时数据仪表板测试</h2>
      <div class="test-controls">
        <button class="btn primary" onclick="testDashboard()">初始化仪表板</button>
        <button class="btn" onclick="refreshDashboard()">刷新数据</button>
        <button class="btn" onclick="toggleAutoRefresh()">切换自动刷新</button>
        <span id="dashboard-status" class="status"></span>
      </div>
      
      <div id="dashboard-container" style="min-height: 600px; border: 1px solid #e5e7eb; border-radius: 8px; margin-top: 20px;">
        <!-- 仪表板将在这里渲染 -->
      </div>
    </section>
  </div>

  <!-- 引入图表组件 -->
  <script type="module">
    import { ChartComponent } from './components/ChartComponent.js';
    import { ProgressChart } from './components/ProgressChart.js';
    import { QuizStatsChart } from './components/QuizStatsChart.js';
    import { DashboardWidget } from './components/DashboardWidget.js';

    // 全局变量
    window.charts = {};
    window.dashboard = null;

    // 测试基础图表
    window.testBasicCharts = function() {
      try {
        // 柱状图
        const barChart = new ChartComponent(document.getElementById('bar-chart'));
        const barData = [
          { label: '安全操作', value: 85 },
          { label: '违规识别', value: 78 },
          { label: '应急处理', value: 92 },
          { label: '设备使用', value: 73 }
        ];
        barChart.renderBarChart(barData);
        window.charts.bar = barChart;

        // 折线图
        const lineChart = new ChartComponent(document.getElementById('line-chart'));
        const lineData = Array.from({ length: 30 }, (_, i) => ({
          label: `第${i+1}天`,
          value: Math.floor(Math.random() * 50) + 50
        }));
        lineChart.renderLineChart(lineData);
        window.charts.line = lineChart;

        // 饼图
        const pieChart = new ChartComponent(document.getElementById('pie-chart'));
        const pieData = [
          { label: '已完成', value: 65 },
          { label: '进行中', value: 25 },
          { label: '未开始', value: 10 }
        ];
        pieChart.renderPieChart(pieData);
        window.charts.pie = pieChart;

        // 环形图
        const doughnutChart = new ChartComponent(document.getElementById('doughnut-chart'));
        doughnutChart.renderDoughnutChart(pieData, { centerText: '总进度' });
        window.charts.doughnut = doughnutChart;

        document.getElementById('basic-status').textContent = '✅ 测试成功';
        document.getElementById('basic-status').className = 'status success';
      } catch (error) {
        console.error('基础图表测试失败:', error);
        document.getElementById('basic-status').textContent = '❌ 测试失败';
        document.getElementById('basic-status').className = 'status error';
      }
    };

    // 测试学习进度图表
    window.testProgressCharts = function() {
      try {
        // 进度趋势图
        const progressChart = new ProgressChart(document.getElementById('progress-trend'));
        const progressData = Array.from({ length: 30 }, (_, i) => ({
          date: new Date(Date.now() - (29-i) * 24 * 60 * 60 * 1000).toISOString(),
          progress: Math.floor(Math.random() * 30) + 70,
          details: `第${i+1}天学习进度`
        }));
        progressChart.renderProgressTrend(progressData, { type: 'area' });

        // 完成率环形图
        const completionChart = new ProgressChart(document.getElementById('completion-rate'));
        completionChart.renderCompletionRate({ completed: 85, total: 100 });

        // 学习路径进度
        const pathChart = new ProgressChart(document.getElementById('learning-path'));
        const pathData = [
          { name: '基础安全知识', progress: 100 },
          { name: '操作规范学习', progress: 85 },
          { name: '应急处理培训', progress: 60 },
          { name: '实践操作考核', progress: 30 },
          { name: '综合能力评估', progress: 0 }
        ];
        pathChart.renderLearningPath(pathData);

        document.getElementById('progress-status').textContent = '✅ 测试成功';
        document.getElementById('progress-status').className = 'status success';
      } catch (error) {
        console.error('进度图表测试失败:', error);
        document.getElementById('progress-status').textContent = '❌ 测试失败';
        document.getElementById('progress-status').className = 'status error';
      }
    };

    // 测试答题统计图表
    window.testQuizCharts = function() {
      try {
        // 正确率分布
        const accuracyChart = new QuizStatsChart(document.getElementById('accuracy-distribution'));
        const quizData = Array.from({ length: 50 }, (_, i) => ({
          correctAnswers: Math.floor(Math.random() * 10) + 1,
          totalQuestions: 10,
          timeSpent: Math.floor(Math.random() * 300) + 60
        }));
        accuracyChart.renderAccuracyDistribution(quizData);

        // 答题时间分析
        const timeChart = new QuizStatsChart(document.getElementById('time-analysis'));
        const timeData = Array.from({ length: 20 }, (_, i) => ({
          timeSpent: Math.floor(Math.random() * 200) + 100,
          completedAt: new Date(Date.now() - i * 24 * 60 * 60 * 1000).toISOString()
        }));
        timeChart.renderTimeAnalysis(timeData);

        document.getElementById('quiz-status').textContent = '✅ 测试成功';
        document.getElementById('quiz-status').className = 'status success';
      } catch (error) {
        console.error('答题图表测试失败:', error);
        document.getElementById('quiz-status').textContent = '❌ 测试失败';
        document.getElementById('quiz-status').className = 'status error';
      }
    };

    // 测试知识点雷达图
    window.testKnowledgeRadar = function() {
      try {
        const radarChart = new QuizStatsChart(document.getElementById('knowledge-radar'));
        const knowledgeData = [
          { name: '安全操作', accuracy: 85, total: 25, correct: 21 },
          { name: '违规识别', accuracy: 78, total: 20, correct: 16 },
          { name: '应急处理', accuracy: 92, total: 15, correct: 14 },
          { name: '设备使用', accuracy: 73, total: 18, correct: 13 },
          { name: '防护措施', accuracy: 88, total: 22, correct: 19 },
          { name: '规章制度', accuracy: 81, total: 16, correct: 13 }
        ];
        radarChart.renderKnowledgePoints(knowledgeData);
      } catch (error) {
        console.error('雷达图测试失败:', error);
      }
    };

    // 测试仪表板
    window.testDashboard = function() {
      try {
        const container = document.getElementById('dashboard-container');
        if (window.dashboard) {
          window.dashboard.destroy();
        }
        
        window.dashboard = new DashboardWidget(container, {
          refreshInterval: 10000,
          autoRefresh: false
        });
        
        window.dashboard.init().then(() => {
          document.getElementById('dashboard-status').textContent = '✅ 初始化成功';
          document.getElementById('dashboard-status').className = 'status success';
        }).catch(error => {
          console.error('仪表板初始化失败:', error);
          document.getElementById('dashboard-status').textContent = '❌ 初始化失败';
          document.getElementById('dashboard-status').className = 'status error';
        });
      } catch (error) {
        console.error('仪表板测试失败:', error);
        document.getElementById('dashboard-status').textContent = '❌ 测试失败';
        document.getElementById('dashboard-status').className = 'status error';
      }
    };

    // 刷新仪表板
    window.refreshDashboard = function() {
      if (window.dashboard) {
        window.dashboard.loadDashboardData();
      }
    };

    // 切换自动刷新
    window.toggleAutoRefresh = function() {
      if (window.dashboard) {
        if (window.dashboard.refreshTimer) {
          window.dashboard.stopAutoRefresh();
          console.log('自动刷新已停止');
        } else {
          window.dashboard.startAutoRefresh();
          console.log('自动刷新已启动');
        }
      }
    };

    // 页面加载完成后自动运行基础测试
    document.addEventListener('DOMContentLoaded', function() {
      console.log('数据可视化测试页面已加载');
      
      // 延迟执行测试，确保所有组件都已加载
      setTimeout(() => {
        testBasicCharts();
        testProgressCharts();
        testQuizCharts();
        testKnowledgeRadar();
      }, 500);
    });
  </script>
</body>
</html>
